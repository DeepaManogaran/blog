---
layout: post
---

To understand something as complex as the graphics pipeline one must reinvent it with a basic toolset.
I picked the N64 graphics pipeline for this exercise. It is not as complicated as modern day pipelines,
but the combination of z-buffering, Gouraud shading, and texture mapping yields some pretty nice results:

![Donkey Kong](/images/dk.png)

This can be done in about 500 lines of C code. One just needs a 32 bit pointer to video memory,
a strong understanding of linear algebra, and plenty of patience.

# Software renderering like 1996

3D models are stored in wavefront object files. These object files contain a list of vertices and faces.
Faces are trigons composed of any three vertices. In addition to faces and vertices, object file contain
normal vertices for each vertex and texture vertices for each face.

Faces are pushed to a list. Faces are centered around (0, 0, 0) and translated to fit the screen.

Faces are filled by wrapping a 2D rectangle around a trigon. For every pixel of the rectangle
the barycentric coordinate of the tirgon is calculated. If the x, y, and z coordinates of the barycenter
coordinate are all greater than zero then the x and y coordinate of the rectangle is within the trigon.

The amount of light reflected from a trigon is calculated using the dot product of the sum of the trigon vertice
normals with the direction of light from the camera.

Faces in the front may not overlap faces in the back. A Z-buffer keeps track of pixel distance from the viewport.

![Flat shading - Isometric](/images/gel/a.png)

A perspective view is established by dividing the x and y coordinate of each vertex with the
corrosponding z value using (1.0 - z).

![Flat shading - Perspective](/images/gel/b.png)

By reusing the previously calculated barycenter, a varying vertex of the trigon is calculated
with dot products of the normal vertices with the direction of light from the camera.

This technique is known as Gouraud shading.

![Gouraud shading](/images/gel/c.png)

By once again reusing the barycenter, a weighted x and y coordinate can be calculated
by multiplying the x, y, and z coordinates of the barycenter with the x, y, and z coordinates of the texture
vertices of the face.

![Gouraud shading](/images/gel/d.png)

And thats all there is to it, though its easier said than done. Have a look at
the [implementation on my github.](https://github.com/glouw/gel). The code itself will compliment
well this relatively high level walk through.

Theres a [Windows 10 build available here](https://github.com/glouw/gel/releases/download/gel-1.3/gel-1.3.zip).
Extract wholly and just double click the exe. Try out some other models if you like;
open up the command prompt and cd to the extracted folder and run;

```
gel.exe path/to/obj path/to/bmp
```
There's plenty of models to choose from in the included model folder. As for Linux and MacOS folks,
use your package manager to install:
```
SDL2-devel
```
And then just clone the repo and run make.
